<html>
    <head>
        <script src="tictactoe.js"></script>
        <script src="neural_net.js"></script>
        <script src="game.js"></script>
        <script src="player.js"></script>
        <script src="coach.js"></script>
        <style>
        body {
            font-family: monospace;
        }
        ul#log { 
            display: flex;
            flex-direction: column-reverse;
            
            list-style: none;
            margin: 0;
            padding: 0;
        }
        ul#log>li {
            flex: 0 0 auto;
        }
        ul#log>li:nth-child(odd) {
            background-color: #ddd;
        }
        </style>
    </head>
    <body>
        <div id="input">
            <input id="move" type="number" />
            <button onclick="move()">move</button>
        </div>
        <div id="board">

        </div>
        <ul id="log">

        </ul>
        <script>

// extend console.log to print to HTML
(function () {
    var old = console.log;
    var logger = document.getElementById('log');
    console.log = function (message) {
        old.apply( this, arguments ); 
        if (typeof message == 'object') {
            message = (JSON && JSON.stringify ? JSON.stringify(message) : message);
        } else if (message && message.replace) {
            message = message.replace(/\n/g,'<br/>');
        }
        var node = document.createElement("li");
        node.innerHTML = message;
        logger.appendChild(node);
    }
})();









function update () {
    var board = t.toString().replace(/\n/g,'<br/>');;
    document.getElementById('board').innerHTML = board;
}

function move (input) {
    var input = document.getElementById('move').value;
    var move = parseInt(input, 2);
    console.log( move.toString(2) );

    if ( t.takeTurn(move) )
        console.log(`player ${TTT.DRAW.PLAYERS[t.turn]} wins!!!` )
    else
        console.log(`it's  player ${TTT.DRAW.PLAYERS[t.turn]}'s turn` )

    
    
    update();
    updateNN();
    print();
}

function print () {
    n.toString();
    var arr = n.getOutputs();
    var recommendations = arr.map(function(v,i,a){
        return {
            positionIndex: i,
            position: (1 << i),
            score: v
        }
    }).sort(function(a,b){
        return b.score - a.score
    });
    var avail = t.getAvailableMoves();
    recommendations.forEach(function(r){
        // is move valid?
        var a = avail.indexOf(r.position) >= 0 ? ' ***** available' : '';
        console.log(`Next move ${r.positionIndex} (${r.position.toString(2)}) with ${r.score}${a}`);
    })
}

function updateNN () {
    n.setInputs( t.playerBoardToArray() );
    n.update();
}

// var t = new TTT();
// update();

// var inputs = t.playerBoardToArray();
// var outputs = 9;

// var n = new NeuralNet(inputs, outputs);

// print();



        </script>
    </body>
</html>